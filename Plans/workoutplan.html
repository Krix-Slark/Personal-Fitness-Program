<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout | Plan</title>
  <link rel="stylesheet" href="../css/all.min.css">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/workout_plan.css">
  
</head>

<body class="vh-100 bg-dark text-white" data-page="workout">

  <!-- Navbar -->
  <div class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top border-bottom border-success">
    <a href="../index.html" class="navbar-brand" style="color: lime;">
      <i class="fas fa-dumbbell me-3 ms-4" style="color: lime;"></i>FitChallenge
    </a>
    <button class="navbar-toggler bg-success me-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav gap-3 mx-auto">
        <li class="nav-items"><a href="../index.html" class="nav-link">Home</a></li>
        <li class="nav-items"><a href="workoutplan.html" class="nav-link active">Workout Plan</a></li>
        <li class="nav-items"><a href="nutritionplan.html" class="nav-link">Nutrition Plan</a></li>
      </ul>
      <div class="text-decoration-none">
        <a href="#" class="btn btn-success me-4 text-black"
          style="background-color: lime !important; font-weight: 500; font-size: 18px;">Start Challenge</a>
      </div>
    </div>
  </div>

  <!-- Page Header -->
  <div class="container-fluid p-0" style="background-color: rgba(0, 0, 0, 0.4);">
    <div class="container text-center pt-5 mt-5">
      <h1 class="pt-5 fw-bold fs-1">28-Day <span style="color: lime;">Workout Challenge</span></h1>
      <p class="mt-3 text-white-50 fs-4 w-75 mx-auto">
        Transform your body with our progressive strength and cardio program.<br>
        Each day builds on the last for maximum results.
      </p>
    </div>

    <!-- Workout Container (dynamic content will load here) -->
    <div class="container-fluid" id="workoutContainer"></div>
    <div class="text-center my-4">
      <a href="#" id="week5Btn" class="btn btn-outline-success px-4 py-2 fs-3 mb-5">
        Week 5 <i class="fas fa-arrow-right ms-3"></i>
      </a>
    </div>
  </div>
  <!-- Week 5 Button -->

  <!-- Week 5 Not Available Modal -->
  <div class="modal fade" id="week5UnavailableModal" tabindex="-1" aria-labelledby="week5UnavailableLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-white">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" id="week5UnavailableLabel" style="color:lime;">
            ðŸš§ Week 5 Not Available
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p class="lead text-white-50 mb-3">
            Week 5 is not yet available. Please check back soon!
          </p>
          <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">
            OK
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Week 5 Congratulations Modal -->
  <div class="modal fade" id="week5Modal" tabindex="-1" aria-labelledby="week5ModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content bg-dark text-white text-center">
        <div class="modal-header border-0">
          <h5 class="modal-title fw-bold" id="week5ModalLabel" style="color:lime;">
            ðŸŽ‰ Congratulations!
          </h5>
        </div>
        <div class="modal-body">
          <p class="lead text-white-50">
            You have completed the 1st month of your challenge!
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div class="text-center my-5 d-none" id="loadingSpinner">
    <div class="spinner-border text-success" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- JS Scripts -->
  <script src="../js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", async () => {
      const workoutContainer = document.getElementById("workoutContainer");
      const loadingSpinner = document.getElementById("loadingSpinner");

      try {
        const res = await fetch("../data/workout-plan.json");
        if (!res.ok) throw new Error(`Failed to load JSON: ${res.status}`);
        const json = await res.json();
        const weeks = json.weeks || [];
        let currentWeek = 1;

        function renderWeek(weekNum) {
          const week = weeks.find(w => w.week === weekNum);
          if (!week) return;

          loadingSpinner.classList.remove("d-none");

          let html = `
          <div class="mt-5 border-bottom border-success w-25 mx-auto">
            <h1 class="text-center fw-bold" style="color: limegreen; font-size: 3rem;">
              Week ${weekNum}
            </h1>
          </div>
          <div class="container-fluid row mt-5 d-flex justify-content-center align-items-center">`;

          week.days.forEach((day, i) => {
            if (day.skip) return;

            // REST day handling
            if (day.rest) {
              let title = `Day ${day.day}`;
              if (week.days[i + 1] && week.days[i + 1].rest) {
                title = `Day ${day.day} & ${week.days[i + 1].day}`;
                week.days[i + 1].skip = true;
              }
              html += `
              <div class="col-12 col-md-4 mb-4">
                <div class="card bg-dark" style="width:100%;height:400px;">
                  <h1 class="fs-1 fw-bold mx-auto pt-5 mb-5" style="color: limegreen;">${title}</h1>
                  <p class="text-center mx-auto fs-1 text-white-50 mt-4">Rest Day
                     <i class="fas fa-face-smile text-white-50 ms-3"></i>
                  </p>
                  <p class="text-center mx-auto text-white-50 mt-2">
                     ${day.description || ""}
                  </p>
                </div>
              </div>`;
              return;
            }

            // Top badges/images (only exercises with image)
            const seenTopEx = new Set();
            const exTopHTML = (day.exercises || []).filter(ex => ex.image && !seenTopEx.has(ex.name))
              .slice(0, 4)
              .map(ex => {
                seenTopEx.add(ex.name);
                return `
                <div class="text-center">
                  <span class="badge d-block mb-1" style="background-color: limegreen; color:black;">
                    ${ex.name}
                  </span>
                  <img src="${ex.image}" alt="${ex.name}" class="img-fluid rounded">
                </div>`;
              }).join("");

            let videoSection = "";

            // Week 1 old UI
            if (weekNum === 1) {
              videoSection = (day.exercises || []).map(ex => `
              <div class="d-flex align-items-center justify-content-between mt-3 bg-dark shadow-lg">
                <div class="d-flex align-items-center gap-3 ms-3">
                  <video muted playsinline preload="auto" style="width:120px; border-radius:8px;">
                    <source src="${ex.video || ''}" type="video/webm">
                  </video>
                  <span class="fw-bold text-white fs-5">${ex.name || ""}</span>
                </div>
                <div class="text-white me-4 fs-5">
                  <span style="color:lime;">${ex.sets_reps || ex.sets || ""}</span>
                </div>
              </div>`).join("");
            } else {
              // Week 2-4 new UI
              const seenVideos = new Set();
              const exs = (day.exercises || []).filter(ex => {
                const name = ex.name?.trim().toLowerCase() || "";
                if (seenVideos.has(name) && ex.video) return false;
                seenVideos.add(name);
                return true;
              });

              const rows = [];
              for (let j = 0; j < exs.length; j += 2) {
                const pair = exs.slice(j, j + 2).map(ex => `
                  <div class="video-container">
                    <span class="badge d-block mb-1" style="background-color: limegreen; color:black;">${ex.name || ""}</span>
                    <video muted playsinline preload="auto" style="width:120px; border-radius:8px;">
                      <source src="${ex.video || ''}" type="video/webm">
                    </video>
                  </div>
                `).join("");

                rows.push(`
                  <div class="d-flex align-items-center justify-content-around mt-3 bg-dark shadow-lg">
                    ${pair}
                  </div>
                `);
              }

              videoSection = rows.join(`
                <div class="text-center">
                  <i class="fas fa-plus fs-3 pt-3 ms-2" style="color: lime;"></i>
                </div>
              `) + `
              <div class="text-center">
                <i class="fas fa-arrow-down fs-3 pt-3 ms-2" style="color: lime;"></i>
              </div>
              <div class="d-flex align-items-center justify-content-around mt-3 bg-dark shadow-lg">
                <div class="text-white fs-5 py-2">
                  <span style="color:lime;">${day.summaryText || ""}</span>
                </div>
              </div>`;
            }

            html += `
            <div class="col-12 col-md-4 mb-4">
              <div class="card h-100 bg-dark">
                <div class="card-body d-flex justify-content-between">
                  <h1 class="fs-2 text-start" style="color: lime;">
                    Day ${day.day} <br>
                    <span class="text-black badge">
                      <i class="fas fa-dumbbell text-dark me-2"></i> ${(day.exercises || []).length} exercises
                    </span>
                  </h1>
                  <span class="text-white-50 pt-1">
                    <i class="fas fa-clock me-2" style="color: lime;"></i>${day.duration || ""}
                  </span>
                </div>

                <div class="card-body pt-0">
                  <div class="d-flex justify-content-center gap-3 flex-wrap">
                    ${exTopHTML}
                  </div>
                </div>

                ${videoSection}

                <div class="button-container mt-4 d-flex justify-content-around mb-3">
                  <a href="${day.details_link || ('../Detail_Plan/index.html?day=' + day.day)}" class="btn btn-dark shadow-lg border-light">
                    <i class="fas fa-info-circle me-2"></i>Details
                  </a>
                  <a href="${day.start_link || '#'}" class="btn btn-success px-3">
                    <i class="fas fa-play me-2"></i>Start
                  </a>
                </div>
              </div>
            </div>`;
          });

          html += "</div>";
          workoutContainer.insertAdjacentHTML("beforeend", html);
          loadingSpinner.classList.add("d-none");
        }

        // Initial load
        renderWeek(currentWeek);

        // Infinite scroll
        window.addEventListener("scroll", () => {
          if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 200) {
            if (currentWeek < weeks.length) {
              currentWeek++;
              renderWeek(currentWeek);
            }
          }
        });

      } catch (err) {
        console.error(err);
        loadingSpinner.classList.add("d-none");
        workoutContainer.insertAdjacentHTML("beforeend", `<p class="text-center text-danger mt-4">Could not load workout data.</p>`);
      }
    });
    document.addEventListener('DOMContentLoaded', () => {
  const week5Btn = document.getElementById('week5Btn');
  if (!week5Btn) return;

  fetch("../data/detail-plans.json")
    .then(res => res.json())
    .then(data => {
      const hasWeek5 = data.days.some(d => d.day > 28); // >28 = week5
      if (!hasWeek5) {
        // âœ… Show Bootstrap modal instead of alert
        week5Btn.addEventListener('click', () => {
          const modal = new bootstrap.Modal(
            document.getElementById('week5UnavailableModal')
          );
          modal.show();
        });
      } else {
        // Week 5 exists â†’ congratulation modal then redirect
        week5Btn.addEventListener('click', () => {
          const modal = new bootstrap.Modal(
            document.getElementById('week5Modal')
          );
          modal.show();
          setTimeout(() => {
            window.location.href = "index.html?day=29";
          }, 3000);
        });
      }
    });
});

  </script>
</body>

</html>